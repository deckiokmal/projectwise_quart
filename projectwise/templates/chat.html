<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}ProjectWise Chat{% endblock %}</title>

    <!-- CSS global -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
    {% block head %}{% endblock %}
</head>

<body>
    <div class="app-container">

        <!-- Sidebar kiri -->
        <aside class="sidebar">
            <div class="sidebar__brand">
                {% block sidebar_brand %}Projectwise{% endblock %}
            </div>
            <nav class="sidebar__nav">
                {% block sidebar_nav %}
                <ul>
                    <li class="active"><a href="#">New chat</a></li>
                    <li><a href="#">Search chats</a></li>
                    <li><a href="#">Library</a></li>
                    <li><a href="#">Codex</a></li>
                </ul>
                {% endblock %}
            </nav>
            <div class="sidebar__footer">
                {% block sidebar_footer %}© 2025 ProjectWise{% endblock %}
            </div>
        </aside>

        <!-- Konten utama/chat di kanan -->
        <main class="main">
            {% block body %}
            <div class="app-container">
                <!-- Sidebar tetap seperti sebelumnya... -->

                <main class="main">
                    <header class="main__header">
                        <h1>Where should we begin?</h1>
                    </header>

                    <section class="main__chat">
                        <!-- Pesan akan ter-render di sini -->
                    </section>

                    <footer class="main__input">
                        <form id="chat-form" autocomplete="off">
                            <!-- Baris 1: Text input -->
                            <div class="input-row">
                                <textarea id="chat-input" name="message" placeholder="Ask anything" autocomplete="off"
                                    required rows="1"></textarea>
                            </div>


                            <!-- Baris 2: Upload + Send -->
                            <div class="input-row input-row--actions">
                                <!-- Tombol “+” dengan dropdown (drop-up) -->
                                <div class="upload-dropdown">
                                    <button type="button" id="upload-btn" class="btn btn--icon" title="Upload">
                                        <i class="fa-solid fa-plus"></i>
                                    </button>
                                    <!-- Menu drop-up -->
                                    <div id="upload-menu" class="upload-menu hidden">
                                        <button type="button" data-type="kak" class="upload-menu__item">
                                            <i class="fa-regular fa-file-lines"></i> Upload KAK
                                        </button>
                                        <button type="button" data-type="product" class="upload-menu__item">
                                            <i class="fa-solid fa-box"></i> Upload Product
                                        </button>
                                    </div>
                                </div>

                                <!-- Tombol kirim -->
                                <button type="submit" class="btn btn--send" title="Send Message">
                                    <i class="fa-solid fa-paper-plane"></i>
                                </button>
                            </div>


                            <!-- Hidden file input -->
                            <input type="file" id="file-input" name="files" class="hidden" multiple />
                        </form>
                    </footer>

                </main>
            </div>
            {% endblock %}
        </main>

    </div>

    <!-- Modal Overlay & Form KAK/TOR -->
    <div id="modal-kak" class="modal hidden">
        <div class="modal__backdrop"></div>
        <div class="modal__dialog">
            <header class="modal__header">
                <h2>Upload KAK/TOR</h2>
                <button class="modal__close" data-close="modal-kak">&times;</button>
            </header>

            <!-- Sesuaikan action & method ke Flask proxy endpoint -->
            <form id="form-kak" class="modal__form" action="/upload-kak-via-flask/" method="post"
                enctype="multipart/form-data">
                <div class="form-group">
                    <label for="kak-project">Nama Proyek</label>
                    <input type="text" id="kak-project" name="project_name" placeholder="Contoh: Proyek X" required />
                </div>

                <div class="form-group">
                    <label for="kak-pelanggan">Pelanggan</label>
                    <input type="text" id="kak-pelanggan" name="pelanggan" placeholder="Contoh: PT. Contoh Abadi"
                        required />
                </div>

                <div class="form-group">
                    <label for="kak-tahun">Tahun</label>
                    <input type="number" id="kak-tahun" name="tahun" placeholder="2025" min="2000" max="2100"
                        required />
                </div>

                <div class="form-group">
                    <label for="kak-file">Pilih File (PDF)</label>
                    <input type="file" id="kak-file" name="file" accept=".pdf,.doc,.docx" required />
                </div>

                <div class="modal__actions">
                    <button type="button" data-close="modal-kak">Batal</button>
                    <button type="submit">Upload</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Modal Overlay & Form Product -->
    <div id="modal-product" class="modal hidden">
        <div class="modal__backdrop"></div>
        <div class="modal__dialog">
            <header class="modal__header">
                <h2>Upload Product</h2>
                <button class="modal__close" data-close="modal-product">&times;</button>
            </header>
            <form id="form-product" class="modal__form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="product-name">Nama Product</label>
                    <input type="text" id="product-name" name="name" required />
                </div>
                <div class="form-group">
                    <label for="product-file">Pilih File (Gambar/Doc)</label>
                    <input type="file" id="product-file" name="file" accept="image/*,.pdf,.doc,.docx" required />
                </div>
                <div class="modal__actions">
                    <button type="button" data-close="modal-product">Batal</button>
                    <button type="submit">Upload</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Markdown-it for full Markdown support -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/js/all.min.js"></script>
    {% block scripts %}{% endblock %}

</body>

</html>